\documentclass{article}
\usepackage{algorithm}
\usepackage{algorithmic}

\begin{document}

\section*{Algorithm: Outlier/Cluster Detection with Topic Distributions}

\begin{algorithm}
\caption{Outlier/Cluster Detection Algorithm for Bank 10-K Items}
\begin{algorithmic}[1]
\REQUIRE Text data for Item $i$ of bank $j$ over years $t = 1, \dots, T$.
\ENSURE Continuous outlier and cluster scores normalized by holding company asset size.

\FORALL{years $t \in \{1, \dots, T\}$}
    \FORALL{banks $j$}
        \STATE Extract text $I_{i,j,t}$ for Item $i$ of bank $j$ at year $t$.
        \STATE Split $I_{i,j,t}$ into semantic chunks or paragraphs.
        \STATE Clean $I_{i,j,t}$ by removing stopwords and performing preprocessing.
        \STATE Build topic model using BERTopic:
        \begin{enumerate}
            \item Generate topics $k$ and embeddings $v_{k}$ for each chunk.
            \item Apply hierarchical clustering to group topics into parent topics.
            \item Select parent topics based on hierarchical levels or topic coverage.
        \end{enumerate}
        \STATE Compute topic distributions $D_{i,j,t}$ as percentages:
        \begin{enumerate}
            \item Normalize counts of topics by total topic occurrences in year $t$.
            \item Optionally compute weighted topic distributions based on order of topics discussed.
        \end{enumerate}
    \ENDFOR
\ENDFOR

\STATE Aggregate topic distributions $D_{i,j,t}$ over all years $t$ for each bank $j$.

\STATE Compute embedding matrix $V_{i,j}$ using aggregated topic distributions.

\STATE Apply clustering and outlier detection:
\begin{enumerate}
    \item Use KMeans clustering to determine optimal clusters $k$ using silhouette score.
    \item Test for multivariate normality of $V_{i,j}$:
    \begin{itemize}
        \item \textbf{If normality is True:}
        \begin{enumerate}
            \item Apply robust Mahalanobis distance using Minimum Covariance Determinant (MCD).
            \item Apply Local Outlier Factor (LOF).
            \item Flag points as outliers if identified by both Mahalanobis distance and LOF.
        \end{enumerate}
        \item \textbf{Else:}
        \begin{enumerate}
            \item Apply only LOF for outlier detection.
        \end{enumerate}
    \end{itemize}
\end{enumerate}

\STATE Convert discrete outlier and cluster outputs into continuous scores.
\STATE Normalize outlier and cluster scores by holding company asset size.

\RETURN Continuous outlier and cluster scores.

\end{algorithmic}
\end{algorithm}

\end{document}
